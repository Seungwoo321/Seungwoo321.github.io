(window.webpackJsonp=window.webpackJsonp||[]).push([[25],{266:function(s,t,n){"use strict";n.r(t);var a=n(2),r=Object(a.a)({},(function(){var s=this,t=s.$createElement,n=s._self._c||t;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h1",{attrs:{id:"backtest-pseudo-code"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#backtest-pseudo-code"}},[s._v("#")]),s._v(" Backtest pseudo code")]),s._v(" "),n("p",[s._v("grademark 로 백테스트한 매매 로직을 node.js로 거래소 API 를 연동해 6개월 동안 자동 매매를 해본 결과, 거의 동일하게 동작해서 비슷한 결과가 나오는데, 일부 다르게 동작하는 부분으로 인해서 때로는 큰 차이가 있기도 하다. 시간이 지나서 오늘을 다시 시뮬레이션 했을 때 최대한 동일한 타이밍에서 매매가 이루어 지게끔 봇 프로그램 개선의 필요를 느끼게 되었다. 그래서 백테스트에 사용한 grademark 의 로직을 그대로 적용하기 위해서 내 스스로가 이해 하기 쉽도록 의사코드로 정리 해보았다. (의사코드를 처음 작성해보는 거라서 지속적으로 업데이트 할 예정이다.)")]),s._v(" "),n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("case")]),s._v(" 포지션 상태가 None 일 때\n    strategy"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("entryRule 메서드 "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("호출")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("enterPosition와 옵션을 파라메터로 전달"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("enterPosition 함수는 포지션 상태와 진입 할 방향"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" 트리거된 가격을 업데이트 한다"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" 바로 진입 x"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" \n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("case")]),s._v(" 포지션 상태가 Enter 일 때\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" conditionalEntryPrice 가 정의되어 있으면\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 1. 진입을 해야하는지 추세 확인 ")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" 방향이 롱 인데 고가가 트리거 가격보다 낮으면\n            추세가 상방으로 판단되지 않으므로 정지\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("break")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" 방향이 숏 인데 저가가 트리거 가격보다 크면\n            추세가 하방으로 판단되지 않으므로 정지\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("break")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 진입 가격 = 시가")]),s._v("\n    entryPrice "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" bar"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("open\n\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 2. 신규 포지션을 정의")]),s._v("\n    openPosition "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        direction\n        entryTime\n        entryPrice"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" 트리거 가격 or 시가 \n        growth"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("로 초기화\n        profit"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("으로 초기화\n        profitPct"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("으로 초기화\n        holdingPeriod"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("으로 초기화\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 3 - 1 curStopPrice 값을 정의")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" stopLoss 전략이 있으면\n        기본 스탑 차이 정의 "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" stopLoss 메서드 호출\n        오픈 포지션의 initialStopPrice 값 정의 "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" \n            롱이면 진입 가격에서 기본 스탑 차이 만큼 뺀다\n            숏이면 진입 가격에 기본 스탑 차이 만큼 더한다 \n        오픈 포지션의 curStopPrice 값 정의 "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" \n            오픈포지션의 initialStopPrice\n\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 3 - 2 curStopPrice 값을 정의")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" trailingStopLoss 전략이 있으면\n        후행 스탑 차이 정의 "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" trailingStopLoss 메서드 호출 \n        후행 스탑 가격 정의 "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" \n            롱이면 진입 가격에서 후행 스탑 차이 만큼 뺀다\n            숏이면 진입 가격에서 후행 스탑 차이 만큼 더한다\n\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" 오픈 포지션의 initialStopPrice 가 정의되지 않았으면 \n            오픈 포지션의 initialStopPrice 값 정의 "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" 후행 스탑 "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("가격")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("trailingStopPrice"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("정의 되어있으면"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n            오픈 포지션의 initialStopPrice 값 정의 "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("\n                롱이면 오픈 포지션의 initialStopPrice 와 후행 스탑 "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("가격")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("trailingStopPrice"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" 중 큰 값\n                숏이면 오픈 포지션의 initialStopPrice 와 후행 스탑 "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("가격")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("trailingStopPrice"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" 중 작은 값\n\n        오픈 포지션의 curStopPrice 값 정의 "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" \n            오픈포지션의 initialStopPrice\n\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" 백테스트 옵션의 recordStopPrice 가 "),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v(" 이면 \n            openPosition"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("stopPriceSeries 값 정의 "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                time"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" bar"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("time"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n                value"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" openPosition"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("curStopPrice\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 4. (3) 에서 최종 정의 된 손절가격으로 리스크 정의 및 기록")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" openPosition"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("curStopPrice 가 정의되어 있으면 \n        openPosition"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("initialUnitRisk 값 정의 "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" \n            롱이면 진입 가격에서 openPosition"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("curStopPrice 을 뺀 값\n            숏이면 openPosition"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("curStopPrice 에서 진입 가격을 뺀 값\n\n        openPosition"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("initialRiskPct 값 정의 "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("openPosition"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("initialUnitRisk  "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v(" 진입가격"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("\n        openPosition"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("curRiskPct "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" openPosition"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("initialRiskPct \n        openPosition"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("curRMultiple "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" 백테스트 옵션의 recordRisk 값이 "),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v(" 이면\n        openPosition"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("riskSeries  값 정의 "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                time"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" bar"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("time"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n                value"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" openPosition"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("curRiskPct\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 5. 수익 목표 전략이 있으면 목표가에 주문 ")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" profitTarget 전략이 있으면 \n        수익 차이를 정의 "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" profitTarget 메서드를 호출 \n        openPosition"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("profitTarget 값 정의 "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" \n            롱이면 진입가격 "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" 수익 차이 \n            숏이면 진입가격 "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" 수익 차이\n\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 6. 포지션 상태를 Position 으로 업데이트")]),s._v("\n    positionStatus "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" PositionStatus"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Position"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 7. 포지션 진입 로직 종료")]),s._v("\n    종료 \n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("break")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("case")]),s._v(" 포지션 상태가 Position 일 때\n\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 1. 진입방향에 따라 손절 진행 ")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" openPosition 의 curStopPrice 가 정의되어 있으면\n\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" 롱이면\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" curStopPrice 이 저가보다 작거나 같으면 \n                포지션 "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("종료")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("closePosition 함수 호출"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("break")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),s._v(" 숏이면  \n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" curStopPrice 이 고가보다 크거나 같으면\n                포지션 "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("종료")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("closePosition 함수 호출"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("break")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 2. 후행 정지 가격이 손절가격보다 더 좋으면 적용 ")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" trailingStopLoss 전략이 정의되어 있으면\n\n        후행 정지 "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("차이")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("trailingStopDistance"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" 값 정의 "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("\n            trailingStopLoss 메서드 호출 \n\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" 방향이 롱이면 \n            새로운 후행 정지 가격 값 정의 "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" 종가 "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" 후행 가격 차이\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" 새로운 후행 정지 가격이 curStopPrice 보다 크면\n                curStopPrice 값 정의 "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" 새로운 후행 정지 가격 \n\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),s._v(" 방향이 숏이면\n            새로운 후행 정지 가격 값 정의 "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" 종가 "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" 후행 가격 차이\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" 새로운 후행 정지 가격이 curStopPrice 보다 작으면\n                curStopPrice 값 정의 "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" 새로운 후행 정지 가격 \n\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" 백테스트 옵션의 recordStopPrice 값이 "),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v(" 이면\n            오픈 포지션의 stopPriceSeries 배열에 값을 "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("푸시")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                time"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" bar"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("time"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n                value"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" openPosition"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("curStopPrice\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 3. 수익목표에 따른 포지션 정리 ")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" 수익목표가 정의되어 있으면\n\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" 방향이 롱이면\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" 고가가 수익목표가 보다 크거나 같으면\n                포지션 "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("종료")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("closePosition 함수 호출"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("break")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),s._v(" 방향이 숏이면\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" 저가가 수익 목표가 보다 작거나 같으면\n                포지션 "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("종료")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("closePosition 함수 호출"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("break")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 4. 포지션 업데이트")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("updatePosition")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("openPosition"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" bar"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        수익금"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" 수익률 업데이트\n        리스크 업데이트\n        홀딩 기간 "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 5. 옵션 여부에 따라 리스크 기록 ")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" curRiskPct 가 정의되어 있고 백테스트 옵션의 recordRisk 값이 "),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v(" 이면\n        오픈 포지션에 riskSeries 배열에 값을 "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("푸시")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            time"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" bar"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("time"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n            value"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" openPosition"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("curRiskPct"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 6. 포지션 정리")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" exitRule 전략이 있으면\n        strategy"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("exitRule 메서드 "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("호출")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("exitPosition 와 옵션을 파라메터로 전달"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        포지션 상태를 Exit 로 변경\n\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 7. 포지션이 있을 때 로직 종료 ")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("break")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("case")]),s._v(" 포지션 상태가 Exit 일 때\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 1. 포지션 정리 ")]),s._v("\n    closePosition 함수 호출 \n        시가로 포지션 정리\n        포지션 상태를 None 으로 변경\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("break")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br"),n("span",{staticClass:"line-number"},[s._v("50")]),n("br"),n("span",{staticClass:"line-number"},[s._v("51")]),n("br"),n("span",{staticClass:"line-number"},[s._v("52")]),n("br"),n("span",{staticClass:"line-number"},[s._v("53")]),n("br"),n("span",{staticClass:"line-number"},[s._v("54")]),n("br"),n("span",{staticClass:"line-number"},[s._v("55")]),n("br"),n("span",{staticClass:"line-number"},[s._v("56")]),n("br"),n("span",{staticClass:"line-number"},[s._v("57")]),n("br"),n("span",{staticClass:"line-number"},[s._v("58")]),n("br"),n("span",{staticClass:"line-number"},[s._v("59")]),n("br"),n("span",{staticClass:"line-number"},[s._v("60")]),n("br"),n("span",{staticClass:"line-number"},[s._v("61")]),n("br"),n("span",{staticClass:"line-number"},[s._v("62")]),n("br"),n("span",{staticClass:"line-number"},[s._v("63")]),n("br"),n("span",{staticClass:"line-number"},[s._v("64")]),n("br"),n("span",{staticClass:"line-number"},[s._v("65")]),n("br"),n("span",{staticClass:"line-number"},[s._v("66")]),n("br"),n("span",{staticClass:"line-number"},[s._v("67")]),n("br"),n("span",{staticClass:"line-number"},[s._v("68")]),n("br"),n("span",{staticClass:"line-number"},[s._v("69")]),n("br"),n("span",{staticClass:"line-number"},[s._v("70")]),n("br"),n("span",{staticClass:"line-number"},[s._v("71")]),n("br"),n("span",{staticClass:"line-number"},[s._v("72")]),n("br"),n("span",{staticClass:"line-number"},[s._v("73")]),n("br"),n("span",{staticClass:"line-number"},[s._v("74")]),n("br"),n("span",{staticClass:"line-number"},[s._v("75")]),n("br"),n("span",{staticClass:"line-number"},[s._v("76")]),n("br"),n("span",{staticClass:"line-number"},[s._v("77")]),n("br"),n("span",{staticClass:"line-number"},[s._v("78")]),n("br"),n("span",{staticClass:"line-number"},[s._v("79")]),n("br"),n("span",{staticClass:"line-number"},[s._v("80")]),n("br"),n("span",{staticClass:"line-number"},[s._v("81")]),n("br"),n("span",{staticClass:"line-number"},[s._v("82")]),n("br"),n("span",{staticClass:"line-number"},[s._v("83")]),n("br"),n("span",{staticClass:"line-number"},[s._v("84")]),n("br"),n("span",{staticClass:"line-number"},[s._v("85")]),n("br"),n("span",{staticClass:"line-number"},[s._v("86")]),n("br"),n("span",{staticClass:"line-number"},[s._v("87")]),n("br"),n("span",{staticClass:"line-number"},[s._v("88")]),n("br"),n("span",{staticClass:"line-number"},[s._v("89")]),n("br"),n("span",{staticClass:"line-number"},[s._v("90")]),n("br"),n("span",{staticClass:"line-number"},[s._v("91")]),n("br"),n("span",{staticClass:"line-number"},[s._v("92")]),n("br"),n("span",{staticClass:"line-number"},[s._v("93")]),n("br"),n("span",{staticClass:"line-number"},[s._v("94")]),n("br"),n("span",{staticClass:"line-number"},[s._v("95")]),n("br"),n("span",{staticClass:"line-number"},[s._v("96")]),n("br"),n("span",{staticClass:"line-number"},[s._v("97")]),n("br"),n("span",{staticClass:"line-number"},[s._v("98")]),n("br"),n("span",{staticClass:"line-number"},[s._v("99")]),n("br"),n("span",{staticClass:"line-number"},[s._v("100")]),n("br"),n("span",{staticClass:"line-number"},[s._v("101")]),n("br"),n("span",{staticClass:"line-number"},[s._v("102")]),n("br"),n("span",{staticClass:"line-number"},[s._v("103")]),n("br"),n("span",{staticClass:"line-number"},[s._v("104")]),n("br"),n("span",{staticClass:"line-number"},[s._v("105")]),n("br"),n("span",{staticClass:"line-number"},[s._v("106")]),n("br"),n("span",{staticClass:"line-number"},[s._v("107")]),n("br"),n("span",{staticClass:"line-number"},[s._v("108")]),n("br"),n("span",{staticClass:"line-number"},[s._v("109")]),n("br"),n("span",{staticClass:"line-number"},[s._v("110")]),n("br"),n("span",{staticClass:"line-number"},[s._v("111")]),n("br"),n("span",{staticClass:"line-number"},[s._v("112")]),n("br"),n("span",{staticClass:"line-number"},[s._v("113")]),n("br"),n("span",{staticClass:"line-number"},[s._v("114")]),n("br"),n("span",{staticClass:"line-number"},[s._v("115")]),n("br"),n("span",{staticClass:"line-number"},[s._v("116")]),n("br"),n("span",{staticClass:"line-number"},[s._v("117")]),n("br"),n("span",{staticClass:"line-number"},[s._v("118")]),n("br"),n("span",{staticClass:"line-number"},[s._v("119")]),n("br"),n("span",{staticClass:"line-number"},[s._v("120")]),n("br"),n("span",{staticClass:"line-number"},[s._v("121")]),n("br"),n("span",{staticClass:"line-number"},[s._v("122")]),n("br"),n("span",{staticClass:"line-number"},[s._v("123")]),n("br"),n("span",{staticClass:"line-number"},[s._v("124")]),n("br"),n("span",{staticClass:"line-number"},[s._v("125")]),n("br"),n("span",{staticClass:"line-number"},[s._v("126")]),n("br"),n("span",{staticClass:"line-number"},[s._v("127")]),n("br"),n("span",{staticClass:"line-number"},[s._v("128")]),n("br"),n("span",{staticClass:"line-number"},[s._v("129")]),n("br"),n("span",{staticClass:"line-number"},[s._v("130")]),n("br"),n("span",{staticClass:"line-number"},[s._v("131")]),n("br"),n("span",{staticClass:"line-number"},[s._v("132")]),n("br"),n("span",{staticClass:"line-number"},[s._v("133")]),n("br"),n("span",{staticClass:"line-number"},[s._v("134")]),n("br"),n("span",{staticClass:"line-number"},[s._v("135")]),n("br"),n("span",{staticClass:"line-number"},[s._v("136")]),n("br"),n("span",{staticClass:"line-number"},[s._v("137")]),n("br"),n("span",{staticClass:"line-number"},[s._v("138")]),n("br"),n("span",{staticClass:"line-number"},[s._v("139")]),n("br"),n("span",{staticClass:"line-number"},[s._v("140")]),n("br"),n("span",{staticClass:"line-number"},[s._v("141")]),n("br"),n("span",{staticClass:"line-number"},[s._v("142")]),n("br"),n("span",{staticClass:"line-number"},[s._v("143")]),n("br"),n("span",{staticClass:"line-number"},[s._v("144")]),n("br"),n("span",{staticClass:"line-number"},[s._v("145")]),n("br"),n("span",{staticClass:"line-number"},[s._v("146")]),n("br"),n("span",{staticClass:"line-number"},[s._v("147")]),n("br"),n("span",{staticClass:"line-number"},[s._v("148")]),n("br"),n("span",{staticClass:"line-number"},[s._v("149")]),n("br"),n("span",{staticClass:"line-number"},[s._v("150")]),n("br"),n("span",{staticClass:"line-number"},[s._v("151")]),n("br"),n("span",{staticClass:"line-number"},[s._v("152")]),n("br"),n("span",{staticClass:"line-number"},[s._v("153")]),n("br"),n("span",{staticClass:"line-number"},[s._v("154")]),n("br"),n("span",{staticClass:"line-number"},[s._v("155")]),n("br"),n("span",{staticClass:"line-number"},[s._v("156")]),n("br"),n("span",{staticClass:"line-number"},[s._v("157")]),n("br"),n("span",{staticClass:"line-number"},[s._v("158")]),n("br"),n("span",{staticClass:"line-number"},[s._v("159")]),n("br"),n("span",{staticClass:"line-number"},[s._v("160")]),n("br"),n("span",{staticClass:"line-number"},[s._v("161")]),n("br"),n("span",{staticClass:"line-number"},[s._v("162")]),n("br"),n("span",{staticClass:"line-number"},[s._v("163")]),n("br"),n("span",{staticClass:"line-number"},[s._v("164")]),n("br"),n("span",{staticClass:"line-number"},[s._v("165")]),n("br"),n("span",{staticClass:"line-number"},[s._v("166")]),n("br"),n("span",{staticClass:"line-number"},[s._v("167")]),n("br"),n("span",{staticClass:"line-number"},[s._v("168")]),n("br"),n("span",{staticClass:"line-number"},[s._v("169")]),n("br"),n("span",{staticClass:"line-number"},[s._v("170")]),n("br"),n("span",{staticClass:"line-number"},[s._v("171")]),n("br")])]),n("h2",{attrs:{id:"실제-적용-가능한-것과-적용-하기-어려운-것"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#실제-적용-가능한-것과-적용-하기-어려운-것"}},[s._v("#")]),s._v(" 실제 적용 가능한 것과 적용 하기 어려운 것")]),s._v(" "),n("ul",[n("li",[s._v("실제 매매와 백테스트의 매매 로직이 다르면 시뮬레이션 하는 의미가 없기 때문에 양쪽이 최대한 동일한 타이밍으로 매매가 이루어져야 한다.")])]),s._v(" "),n("h3",{attrs:{id:"실제-적용-해볼-것"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#실제-적용-해볼-것"}},[s._v("#")]),s._v(" 실제 적용 해볼 것")]),s._v(" "),n("ul",[n("li",[s._v("매수/매도 조건에 해당되어 트리거가 발생 했을 때 바로 매매 하는 것이 아닌, 다음 캔들의 시가에서 진입/정리 하기")]),s._v(" "),n("li",[s._v("포지션 상태를 db 혹은 파일로 저장해서 실제 매매에서 이 상태 값을 참조하기")]),s._v(" "),n("li",[s._v("trailingStopLoss 로직 구현하기")])]),s._v(" "),n("h3",{attrs:{id:"적용하기-어려운-것"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#적용하기-어려운-것"}},[s._v("#")]),s._v(" 적용하기 어려운 것")]),s._v(" "),n("ul",[n("li",[s._v("진입을 해야하는지 추세 확인 하는 부분에서 이전 캔들에서 트리거 된 후 다음 캔들의 위치로 고가와 저가가 완성되지 않은 시점이기 때문에, 실제 적용이 불가능하다. 따라서, 백테스트 로직을 시가로 수정해서 시뮬레이션 하는게 맞는것으로 보인다.")])]),s._v(" "),n("h2",{attrs:{id:"comment"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#comment"}},[s._v("#")]),s._v(" Comment")]),s._v(" "),n("ul",[n("li",[s._v("로직을 텍스트로 정리하기 전까지는 모르고 있었던 trailing Stop 에 대해서 알게 되었다.")]),s._v(" "),n("li",[s._v("지금 실행중인 매매 로직과 차이가 나는 부분을 명확하게 이해 할 수 있었다.")]),s._v(" "),n("li",[s._v("정리한 의사코드 텍스트를 참고하는게 빠르고 정확하게 개발이 가능 할 것 같다.")])]),s._v(" "),n("h2",{attrs:{id:"참조링크"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#참조링크"}},[s._v("#")]),s._v(" 참조링크")]),s._v(" "),n("ul",[n("li",[n("a",{attrs:{href:"https://github.com/Grademark/grademark/blob/0ce580cfa1c9d56e9f0788ce97f9b8f4df2eea21/src/lib/backtest.ts",target:"_blank",rel:"noopener noreferrer"}},[s._v("원본 코드 backtest.ts"),n("OutboundLink")],1)]),s._v(" "),n("li",[n("a",{attrs:{href:"https://www.thebalance.com/trailing-stop-1031394",target:"_blank",rel:"noopener noreferrer"}},[s._v("Trailing Stop 이란"),n("OutboundLink")],1)])])])}),[],!1,null,null,null);t.default=r.exports}}]);